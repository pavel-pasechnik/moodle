# --- Moodle Environment ---

MOODLE_IMAGE=pasechnik/moodle_lts_optimized_images:latest
# Default GitHub Actions build produces the :latest tag.
MOODLE_DOMAIN=localhost
MOODLE_URL=http://${MOODLE_DOMAIN}
MOODLE_LANG=ru
MOODLE_TZ=Europe/Kyiv
MOODLE_CONTAINER=moodle  # Docker container name for Moodle

# --- CLI paths for Moodle (used during install.php) ---
MOODLE_PATH_TO_PHP=/usr/local/bin/php
MOODLE_PATH_TO_DU=/usr/bin/du
MOODLE_ASPELL_PATH=/usr/bin/aspell
MOODLE_PATH_TO_DOT=/usr/bin/dot
MOODLE_PATH_TO_GS=/usr/bin/gs
MOODLE_PATH_TO_PDFTOPPM=/usr/bin/pdftoppm

MOODLE_ENABLE_FILESYSTEM_REPOSITORY=1

MOODLE_REVERSE_PROXY=false  # Set true only when serving Moodle behind a trusted proxy/load balancer
MOODLE_SSL_PROXY=false      # Enable if TLS terminates before the container
MOODLE_COOKIE_SECURE=false  # Force secure cookies (set true when using HTTPS)
MOODLE_COOKIE_HTTPONLY=true
MOODLE_COOKIE_PATH=/
MOODLE_COOKIE_DOMAIN=
MOODLE_TRUSTED_PROXY_IPS=   # Comma-separated list of proxy IPs (e.g., Cloudflare ranges)

# SMTP / email delivery
SMTP_HOST=
SMTP_USER=
SMTP_PASS=
SMTP_SECURE=
SMTP_AUTH_TYPE=
SMTP_NOREPLY_ADDRESS=
SMTP_SUPPORT_EMAIL=

# --- Moodle Administrator ---
MOODLE_ADMIN_USER=admin
MOODLE_ADMIN_PASS=Admin@12345
MOODLE_ADMIN_EMAIL=admin@example.com

# --- Database (default: PostgreSQL) ---
DB_TYPE=pgsql
DB_HOST=postgres
DB_PORT=5432
DB_NAME=moodle
DB_USER=moodle
DB_PASSWORD=supersecret

# --- PostgreSQL tuning ---
PG_SHARED_BUFFERS=256MB
PG_WORK_MEM=16MB
PG_MAINTENANCE_WORK_MEM=256MB
PG_EFFECTIVE_CACHE_SIZE=2GB
PG_MAX_CONNECTIONS=200
PG_WAL_BUFFERS=16MB

# --- External Database (for remote production) ---
# If an external database is used, specify the parameters and run docker-compose.prod-ext.yml.
EXTERNAL_DB_HOST=db.example.org
EXTERNAL_DB_PORT=5432
EXTERNAL_DB_USER=moodle_prod
EXTERNAL_DB_PASS=SecretProdPass
EXTERNAL_DB_NAME=moodle
EXTERNAL_DB_TYPE=pgsql

# --- Redis session tuning (used by docker/moodle-entrypoint.sh at runtime) ---
ENABLE_REDIS_SESSION=1
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_DB=0
REDIS_PASSWORD=
REDIS_CACHE_PREFIX=moodle
REDIS_MAXMEMORY=256mb
REDIS_MAXMEMORY_POLICY=allkeys-lru
REDIS_APPENDONLY=no
REDIS_TIMEOUT=2.5
REDIS_READ_TIMEOUT=2.5
REDIS_SESSION_LOCKING=1
REDIS_SESSION_LOCK_RETRIES=200
REDIS_SESSION_LOCK_WAIT=20000
REDIS_SESSION_LOCK_TIMEOUT=120
REDIS_SESSION_LOCK_WARN=0
REDIS_SESSION_LOCK_EXPIRE=7200
REDIS_PCONNECT_POOLING=1

# --- Elasticsearch ---
