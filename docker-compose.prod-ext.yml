services:
  redis:
    image: redis:7-alpine
    restart: unless-stopped
    container_name: redis-prod-ext

  moodle:
    image: ghcr.io/pavel-pasechnik/moodle:latest
    container_name: moodle-prod-ext
    restart: unless-stopped
    depends_on:
      - redis
    ports:
      - "80:80"
    environment:
      MOODLE_DBTYPE: pgsql
      MOODLE_DBHOST: ${MOODLE_DB_HOST}
      MOODLE_DBPORT: ${MOODLE_DB_PORT}
      MOODLE_DBNAME: ${MOODLE_DB_NAME}
      MOODLE_DBUSER: ${MOODLE_DB_USER}
      MOODLE_DBPASS: ${MOODLE_DB_PASS}
      REDIS_HOST: redis
      MOODLE_URL: ${MOODLE_URL}
    volumes:
      - /srv/moodle/moodledata:/var/moodledata
      - ~/.ssh:/root/.ssh:ro
